// Code generated by gen-config.
// data/app.tml
// data/dev/database.tml
// data/dev/view.tml
// data/prod/database.tml
// data/prod/view.tml
// data/test/database.tml
// data/test/view.tml
// DO NOT EDIT

package config

import (
	"path/filepath"
	"strings"

	"github.com/BurntSushi/toml"

	"github.com/gophergala2016/source/core/foundation"
)

type (
	App struct {
		Secret   string `toml:"secret"`
		ClientID string `toml:"client_id"`
		Name     string `toml:"name"`
	}
	Database struct {
		Driver string `toml:"driver"`
		Source string `toml:"source"`
	}
	View struct {
		Ga struct {
			PropertyID string `toml:"property_id"`
		}
		Template struct {
			Delimiters string `toml:"delimiters"`
		}
	}

	ConfigData struct {
		Mode string

		App      App      `toml:"app"`
		Database Database `toml:"database"`
		View     View     `toml:"view"`
	}
)

const configDir = "data"

var config ConfigData = ConfigData{}

func init() {
	Load()
}

func Get() ConfigData {
	return config
}

func Load() {
	mode := foundation.Mode()
	names := []string{
		"app.tml",
		"dev/database.tml",
		"dev/view.tml",
		"prod/database.tml",
		"prod/view.tml",
		"test/database.tml",
		"test/view.tml",
	}
	for _, name := range names {
		dir, _ := filepath.Split(name)
		if len(dir) > 0 && !strings.HasPrefix(dir, mode) {
			continue
		}
		b := MustAsset(filepath.Join(configDir, name))
		err := config.Unmarshal(b)
		if err != nil {
			panic(err)
		}
		foundation.Printf("Load Config File: %s", name)
	}
	config.Mode = mode
}

func (c *ConfigData) Unmarshal(b []byte) error {
	return toml.Unmarshal(b, c)
}

func GetApp() App {
	return Get().App
}

func GetDatabase() Database {
	return Get().Database
}

func GetView() View {
	return Get().View
}
